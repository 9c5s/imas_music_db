---
# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®åå‰
name: ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯

# ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹
on:
  pull_request:
    types:
      - opened
      - synchronize
      - reopened

jobs:
  code-quality:
    runs-on: ubuntu-latest
    name: ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
    # PRã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿ã™ã‚‹ãŸã‚ã®æ¨©é™
    permissions:
      contents: read
      pull-requests: write
    steps:
      # ã‚¹ãƒ†ãƒƒãƒ—1: ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      - name: 1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      # ã‚¹ãƒ†ãƒƒãƒ—2: uvã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆé«˜é€ŸãªPythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼‰
      - name: 2. uvã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        uses: astral-sh/setup-uv@v6
        with:
          enable-cache: true
          cache-dependency-glob: pyproject.toml

      # ã‚¹ãƒ†ãƒƒãƒ—3: ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆé–‹ç™ºä¾å­˜é–¢ä¿‚ã‚’å«ã‚€ï¼‰
      - name: 3. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          uv sync

      # ã‚¹ãƒ†ãƒƒãƒ—4: ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒã‚§ãƒƒã‚¯ã®å®Ÿè¡Œ
      - name: 4. ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
        id: shell_check
        run: |
          # ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒã‚§ãƒƒã‚¯ã®çµæœã‚’ä¿å­˜
          echo "## ğŸš ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆå“è³ªãƒã‚§ãƒƒã‚¯çµæœ" > shell_report.md
          echo "" >> shell_report.md

          # å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
          if ! find . -name "*.sh" -o -name "*.bash" | grep -q .; then
            echo "âœ… å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãªã—: ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" >> shell_report.md
            echo "SHELL_LINT_STATUS=0" >> $GITHUB_OUTPUT
            echo "SHELL_FORMAT_STATUS=0" >> $GITHUB_OUTPUT
            exit 0
          fi

          # shellcheckãƒã‚§ãƒƒã‚¯
          echo "### ShellCheckçµæœ" >> shell_report.md
          if find . -name "*.sh" -o -name "*.bash" | \
            xargs -r uv run shellcheck \
            --rcfile=config/.shellcheckrc > \
            shell_lint_output.txt 2>&1; then
            echo "âœ… ShellCheck: ã‚¨ãƒ©ãƒ¼ãªã—" >> shell_report.md
            SHELL_LINT_STATUS=0
          else
            echo "âŒ ShellCheck: ã‚¨ãƒ©ãƒ¼ã‚ã‚Š" >> shell_report.md
            echo '```' >> shell_report.md
            cat shell_lint_output.txt >> shell_report.md
            echo '```' >> shell_report.md
            SHELL_LINT_STATUS=1
          fi
          echo "" >> shell_report.md

          # shfmtãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
          echo "### shfmtãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯çµæœ" >> shell_report.md
          if find . -name "*.sh" -o -name "*.bash" | \
            xargs -r uv run shfmt -i 2 -p -s -ci -sr -fn -d \
            > shell_format_output.txt 2>&1; then
            echo "âœ… shfmt: å•é¡Œãªã—" >> shell_report.md
            SHELL_FORMAT_STATUS=0
          else
            echo "âŒ shfmt: ä¿®æ­£ãŒå¿…è¦" >> shell_report.md
            echo '```diff' >> shell_report.md
            cat shell_format_output.txt >> shell_report.md
            echo '```' >> shell_report.md
            SHELL_FORMAT_STATUS=1
          fi
          echo "" >> shell_report.md

          # ä¿®æ­£æ–¹æ³•
          if [ $SHELL_LINT_STATUS -ne 0 ] || \
            [ $SHELL_FORMAT_STATUS -ne 0 ]; then
            echo "### ğŸ’¡ ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¿®æ­£æ–¹æ³•" >> shell_report.md
            echo "ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š" >> shell_report.md
            echo '```bash' >> shell_report.md
            if [ $SHELL_LINT_STATUS -ne 0 ]; then
              echo "# ShellCheckãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°ãƒã‚§ãƒƒã‚¯" >> shell_report.md
              echo "uv run shellcheck --rcfile=config/.shellcheckrc \
                ./*.sh scripts/*.sh" >> shell_report.md
            fi
            if [ $SHELL_FORMAT_STATUS -ne 0 ]; then
              echo "# shfmtãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®è‡ªå‹•ä¿®æ­£" >> shell_report.md
              echo "uv run shfmt -i 2 -p -s -ci -sr -fn -w \
                ./*.sh scripts/*.sh" >> shell_report.md
            fi
            echo '```' >> shell_report.md
          fi

          # çµæœã‚’å‡ºåŠ›ã«ä¿å­˜
          echo "SHELL_LINT_STATUS=$SHELL_LINT_STATUS" >> $GITHUB_OUTPUT
          echo "SHELL_FORMAT_STATUS=$SHELL_FORMAT_STATUS" >> $GITHUB_OUTPUT
        continue-on-error: true

      # ã‚¹ãƒ†ãƒƒãƒ—5: YAMLãƒã‚§ãƒƒã‚¯ã®å®Ÿè¡Œ
      - name: 5. YAMLãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
        id: yaml_check
        run: |
          # YAMLãƒã‚§ãƒƒã‚¯ã®çµæœã‚’ä¿å­˜
          echo "## ğŸ“„ YAMLã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯çµæœ" > yaml_report.md
          echo "" >> yaml_report.md

          # å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
          if ! find . \( -name "*.yml" -o -name "*.yaml" \) \
              -not -path "./node_modules/*" | grep -q .; then
            echo "âœ… å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãªã—: YAMLãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" >> yaml_report.md
            echo "YAML_LINT_STATUS=0" >> $GITHUB_OUTPUT
            exit 0
          fi

          # yamllintãƒã‚§ãƒƒã‚¯
          echo "### yamllintçµæœ" >> yaml_report.md
          if uv run yamllint -c config/yamllint.yml . >\
            yaml_lint_output.txt 2>&1; then
            echo "âœ… yamllint: ã‚¨ãƒ©ãƒ¼ãªã—" >> yaml_report.md
            YAML_LINT_STATUS=0
          else
            echo "âŒ yamllint: ã‚¨ãƒ©ãƒ¼ã‚ã‚Š" >> yaml_report.md
            echo '```' >> yaml_report.md
            cat yaml_lint_output.txt >> yaml_report.md
            echo '```' >> yaml_report.md
            YAML_LINT_STATUS=1
          fi
          echo "" >> yaml_report.md

          # ä¿®æ­£æ–¹æ³•
          if [ $YAML_LINT_STATUS -ne 0 ]; then
            echo "### ğŸ’¡ YAMLä¿®æ­£æ–¹æ³•" >> yaml_report.md
            echo "ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š" >> yaml_report.md
            echo '```bash' >> yaml_report.md
            echo "# YAMLãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®è‡ªå‹•ä¿®æ­£" >> yaml_report.md
            echo "uv run yamlfix -c config/yamlfix.toml ." >> yaml_report.md
            echo "" >> yaml_report.md
            echo "# yamllintãƒã‚§ãƒƒã‚¯" >> yaml_report.md
            echo "uv run yamllint -c config/yamllint.yml ." >> yaml_report.md
            echo '```' >> yaml_report.md
          fi

          # çµæœã‚’å‡ºåŠ›ã«ä¿å­˜
          echo "YAML_LINT_STATUS=$YAML_LINT_STATUS" >> $GITHUB_OUTPUT
        continue-on-error: true

      # ã‚¹ãƒ†ãƒƒãƒ—6: Ruffãƒã‚§ãƒƒã‚¯ã®å®Ÿè¡Œã¨çµæœã®ä¿å­˜
      - name: 6. Ruffãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
        id: ruff_check
        run: |
          # Ruffãƒã‚§ãƒƒã‚¯ã®çµæœã‚’ä¿å­˜
          echo "## ğŸ” Ruffã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯çµæœ" > ruff_report.md
          echo "" >> ruff_report.md

          # å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
          if ! find . -name "*.py" -not -path "./node_modules/*" | \
              grep -q .; then
            echo "âœ… å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãªã—: Pythonãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" >> ruff_report.md
            echo "LINT_STATUS=0" >> $GITHUB_OUTPUT
            echo "FORMAT_STATUS=0" >> $GITHUB_OUTPUT
            exit 0
          fi

          # ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°
          echo "### ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°çµæœ" >> ruff_report.md
          if uv run ruff check --config config/ruff.toml >\
            ruff_lint_output.txt 2>&1; then
            echo "âœ… ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°: ã‚¨ãƒ©ãƒ¼ãªã—" >> ruff_report.md
            LINT_STATUS=0
          else
            echo "âŒ ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°: ã‚¨ãƒ©ãƒ¼ã‚ã‚Š" >> ruff_report.md
            echo '```' >> ruff_report.md
            cat ruff_lint_output.txt >> ruff_report.md
            echo '```' >> ruff_report.md
            LINT_STATUS=1
          fi
          echo "" >> ruff_report.md

          # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
          echo "### ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯çµæœ" >> ruff_report.md
          if uv run ruff format --config config/ruff.toml \
            --check --diff > ruff_format_output.txt 2>&1; then
            echo "âœ… ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: å•é¡Œãªã—" >> ruff_report.md
            FORMAT_STATUS=0
          else
            echo "âŒ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: ä¿®æ­£ãŒå¿…è¦" >> ruff_report.md
            echo '```diff' >> ruff_report.md
            cat ruff_format_output.txt >> ruff_report.md
            echo '```' >> ruff_report.md
            FORMAT_STATUS=1
          fi
          echo "" >> ruff_report.md

          # çµ±è¨ˆæƒ…å ±
          echo "### çµ±è¨ˆæƒ…å ±" >> ruff_report.md
          echo '```' >> ruff_report.md
          uv run ruff check --config config/ruff.toml \
            --statistics >> ruff_report.md 2>&1 || true
          echo '```' >> ruff_report.md
          echo "" >> ruff_report.md

          # ä¿®æ­£æ–¹æ³•
          if [ $LINT_STATUS -ne 0 ] || [ $FORMAT_STATUS -ne 0 ]; then
            echo "### ğŸ’¡ Pythonä¿®æ­£æ–¹æ³•" >> ruff_report.md
            echo "ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š" >> ruff_report.md
            echo '```bash' >> ruff_report.md
            if [ $LINT_STATUS -ne 0 ]; then
              echo "# ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°ã‚¨ãƒ©ãƒ¼ã®è‡ªå‹•ä¿®æ­£" >> ruff_report.md
              echo "uv run ruff check --fix \\" >> ruff_report.md
              echo "  --config config/ruff.toml" >> ruff_report.md
            fi
            if [ $FORMAT_STATUS -ne 0 ]; then
              echo "# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®è‡ªå‹•ä¿®æ­£" >> ruff_report.md
              echo "uv run ruff format \\" >> ruff_report.md
              echo "  --config config/ruff.toml" >> ruff_report.md
            fi
            echo '```' >> ruff_report.md
          fi

          # çµæœã‚’å‡ºåŠ›ã«ä¿å­˜
          echo "LINT_STATUS=$LINT_STATUS" >> $GITHUB_OUTPUT
          echo "FORMAT_STATUS=$FORMAT_STATUS" >> $GITHUB_OUTPUT
        continue-on-error: true

      # ã‚¹ãƒ†ãƒƒãƒ—7: Pyrightã«ã‚ˆã‚‹å‹ãƒã‚§ãƒƒã‚¯
      - name: 7. Pyrightå‹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
        id: pyright_check
        run: |
          # Pyrightãƒã‚§ãƒƒã‚¯ã®çµæœã‚’ä¿å­˜
          echo "## ğŸ” Pyrightå‹ãƒã‚§ãƒƒã‚¯çµæœ" > pyright_report.md
          echo "" >> pyright_report.md

          # å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
          if ! find . -name "*.py" -not -path "./node_modules/*" | \
              grep -q .; then
            echo "âœ… å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãªã—: Pythonãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" >> pyright_report.md
            echo "TYPE_CHECK_STATUS=0" >> $GITHUB_OUTPUT
            exit 0
          fi

          # å‹ãƒã‚§ãƒƒã‚¯
          echo "### å‹ãƒã‚§ãƒƒã‚¯çµæœ" >> pyright_report.md
          if uv run pyright -p config/pyrightconfig.json > pyright_output.txt 2>&1; then
            echo "âœ… å‹ãƒã‚§ãƒƒã‚¯: ã‚¨ãƒ©ãƒ¼ãªã—" >> pyright_report.md
            TYPE_CHECK_STATUS=0
          else
            echo "âŒ å‹ãƒã‚§ãƒƒã‚¯: ã‚¨ãƒ©ãƒ¼ã‚ã‚Š" >> pyright_report.md
            echo '```' >> pyright_report.md
            cat pyright_output.txt >> pyright_report.md
            echo '```' >> pyright_report.md
            TYPE_CHECK_STATUS=1
          fi
          echo "" >> pyright_report.md

          # ä¿®æ­£æ–¹æ³•
          if [ $TYPE_CHECK_STATUS -ne 0 ]; then
            echo "### ğŸ’¡ å‹ã‚¨ãƒ©ãƒ¼ä¿®æ­£æ–¹æ³•" >> pyright_report.md
            echo "ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã—ã¦ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼š" >> pyright_report.md
            echo '```bash' >> pyright_report.md
            echo "# å‹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ" >> pyright_report.md
            echo "uv run pyright -p config/pyrightconfig.json" >> pyright_report.md
            echo '```' >> pyright_report.md
            echo "" >> pyright_report.md
            echo "å‹ã‚¨ãƒ©ãƒ¼ã¯æ‰‹å‹•ã§ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚" >> pyright_report.md
            echo "å‹æ³¨é‡ˆã®è¿½åŠ ã€å‹ã®ä¿®æ­£ã€ã¾ãŸã¯è¨­å®šã®èª¿æ•´ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚" >> pyright_report.md
          fi

          # çµæœã‚’å‡ºåŠ›ã«ä¿å­˜
          echo "TYPE_CHECK_STATUS=$TYPE_CHECK_STATUS" >> $GITHUB_OUTPUT
        continue-on-error: true

      # ã‚¹ãƒ†ãƒƒãƒ—8: ç°¡æ½”ãªã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆã®ä½œæˆ
      - name: 8. ãƒ¬ãƒãƒ¼ãƒˆçµ±åˆ
        run: |
          # ç°¡æ½”ãªã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆï¼ˆè©³ç´°ã¯GitHub Actions UIã§ç¢ºèªï¼‰
          cat > combined_report.md << 'EOF'
          # ğŸ” ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯çµæœã‚µãƒãƒªãƒ¼
          EOF

          # å„ãƒã‚§ãƒƒã‚¯ã®çµæœã‚’ã‚µãƒãƒªãƒ¼å½¢å¼ã§çµ±åˆ
          echo "## ğŸ“Š ãƒã‚§ãƒƒã‚¯çµæœä¸€è¦§" >> combined_report.md
          echo "" >> combined_report.md

          # Shell Checkçµæœ
          if [ "${{ steps.shell_check.outputs.SHELL_LINT_STATUS }}" = "0" ] && \
             [ "${{ steps.shell_check.outputs.SHELL_FORMAT_STATUS }}" = \
             "0" ]; then
            echo "âœ… **ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: å•é¡Œãªã—" >> combined_report.md
          else
            echo "âŒ **ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: ã‚¨ãƒ©ãƒ¼ã‚ã‚Š" >> combined_report.md
          fi

          # YAML Checkçµæœ
          if [ "${{ steps.yaml_check.outputs.YAML_LINT_STATUS }}" = "0" ]; then
            echo "âœ… **YAML**: å•é¡Œãªã—" >> combined_report.md
          else
            echo "âŒ **YAML**: ã‚¨ãƒ©ãƒ¼ã‚ã‚Š" >> combined_report.md
          fi

          # Ruff Checkçµæœ
          if [ "${{ steps.ruff_check.outputs.LINT_STATUS }}" = "0" ] && \
             [ "${{ steps.ruff_check.outputs.FORMAT_STATUS }}" = \
             "0" ]; then
            echo "âœ… **Python (Ruff)**: å•é¡Œãªã—" >> combined_report.md
          else
            echo "âŒ **Python (Ruff)**: ã‚¨ãƒ©ãƒ¼ã‚ã‚Š" >> combined_report.md
          fi

          # Pyright Checkçµæœ
          if [ "${{ steps.pyright_check.outputs.TYPE_CHECK_STATUS }}" = \
             "0" ]; then
            echo "âœ… **å‹ãƒã‚§ãƒƒã‚¯ (Pyright)**: å•é¡Œãªã—" >> combined_report.md
          else
            echo "âŒ **å‹ãƒã‚§ãƒƒã‚¯ (Pyright)**: ã‚¨ãƒ©ãƒ¼ã‚ã‚Š" >> combined_report.md
          fi
          echo "" >> combined_report.md
          echo "## ğŸ”§ ä¿®æ­£æ–¹æ³•" >> combined_report.md
          echo "" >> combined_report.md
          echo "ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š" >> combined_report.md
          echo "" >> combined_report.md
          echo "\`\`\`bash" >> combined_report.md
          echo "# Python (Ruff)" >> combined_report.md
          echo "uv run ruff check --fix --config config/ruff.toml" \
            >> combined_report.md
          echo "uv run ruff format --config config/ruff.toml" \
            >> combined_report.md
          echo "" >> combined_report.md
          echo "# YAML" >> combined_report.md
          echo "uv run yamlfix -c config/yamlfix.toml ." >> combined_report.md
          echo "" >> combined_report.md
          echo "# Shell" >> combined_report.md
          echo "uv run shfmt -i 2 -p -s -ci -sr -fn -w ./*.sh scripts/*.sh" \
            >> combined_report.md
          echo "\`\`\`" >> combined_report.md
          echo "" >> combined_report.md
          echo "ğŸ“ **è©³ç´°ãªã‚¨ãƒ©ãƒ¼å†…å®¹**: " \
            "[GitHub Actions UI](https://github.com/${{ github.repository }}" \
            "/actions/runs/${{ github.run_id }})ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚" \
            >> combined_report.md
          echo "ğŸ“Š æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆã‚µã‚¤ã‚º: $(wc -c < combined_report.md) bytes"

      # ã‚¹ãƒ†ãƒƒãƒ—9: PRã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿
      - name: 9. PR ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿
        uses: thollander/actions-comment-pull-request@v3
        with:
          file-path: combined_report.md
          comment-tag: code_quality_check
          mode: recreate

      # ã‚¹ãƒ†ãƒƒãƒ—10: GitHubå½¢å¼ã§ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤º
      - name: 10. GitHubå½¢å¼ã§ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        run: |
          # GitHubå½¢å¼ã§å†åº¦å®Ÿè¡Œï¼ˆActions UIã§ã®è¦–èªæ€§å‘ä¸Šã®ãŸã‚ï¼‰
          echo "=== ShellCheck GitHubå½¢å¼å‡ºåŠ› ==="
          if find . -name "*.sh" -o -name "*.bash" | grep -q .; then
            find . -name "*.sh" -o -name "*.bash" | \
              xargs -r uv run shellcheck --rcfile=config/.shellcheckrc \
              --format=gcc . 2>&1 || true
          else
            echo "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãªã—: ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          fi
          echo "=== yamllint GitHubå½¢å¼å‡ºåŠ› ==="
          if find . \( -name "*.yml" -o -name "*.yaml" \) \
              -not -path "./node_modules/*" | grep -q .; then
            uv run yamllint -c config/yamllint.yml \
              --format github . 2>&1 || true
          else
            echo "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãªã—: YAMLãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          fi
          echo "=== Ruff GitHubå½¢å¼å‡ºåŠ› ==="
          if find . -name "*.py" -not -path "./node_modules/*" | \
              grep -q .; then
            uv run ruff check --config config/ruff.toml \
              --output-format=github . 2>&1 || true
          else
            echo "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãªã—: Pythonãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          fi
          echo "=== Pyright GitHubå½¢å¼å‡ºåŠ› ==="
          if find . -name "*.py" -not -path "./node_modules/*" | \
              grep -q .; then
            uv run pyright -p config/pyrightconfig.json 2>&1 || true
          else
            echo "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãªã—: Pythonãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          fi

      # ã‚¹ãƒ†ãƒƒãƒ—11: å¤±æ•—åˆ¤å®š
      - name: 11. ãƒã‚§ãƒƒã‚¯çµæœã®åˆ¤å®š
        if: >-
          steps.shell_check.outputs.SHELL_LINT_STATUS != '0' ||
          steps.shell_check.outputs.SHELL_FORMAT_STATUS != '0' ||
          steps.yaml_check.outputs.YAML_LINT_STATUS != '0' ||
          steps.ruff_check.outputs.LINT_STATUS != '0' ||
          steps.ruff_check.outputs.FORMAT_STATUS != '0' ||
          steps.pyright_check.outputs.TYPE_CHECK_STATUS != '0'
        run: |-
          echo "âŒ ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ã§ã‚¨ãƒ©ãƒ¼ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚"
          echo "è©³ç´°ã¯PRã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
          exit 1
